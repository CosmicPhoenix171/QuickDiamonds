<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hunter Weapons & Ammo Reference</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root {
    --bg:#0f141b; --panel:#18222d; --ink:#e6f1ff; --accent:#3aa8ff; --grid: #22313f;
    --good:#3bcf6e; --warn:#ffb347; --bad:#ff5964; --muted:#7f94ab;
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  body { margin:0; background:linear-gradient(180deg,#0e1319,#161f28); color:var(--ink); min-height:100vh; }
  header { padding:16px 24px; background:#121a22; border-bottom:1px solid #1f2b35; display:flex; align-items:center; justify-content:space-between; gap:24px; flex-wrap:wrap }
  h1 { margin:0; font-size:clamp(1.2rem,2vw,1.8rem); letter-spacing:.5px }
  .sub { font-size:.8rem; color:var(--muted); margin-top:4px }
  a { color:var(--accent); text-decoration:none }
  a:hover { text-decoration:underline }
  main { padding:20px clamp(12px,3vw,48px); max-width:1400px; margin:0 auto }
  .controls { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px }
  .controls select, .controls input { background:#1d2732; color:var(--ink); border:1px solid #273543; padding:6px 10px; border-radius:6px; font-size:.85rem; min-width:140px }
  .controls input[type=search]{ flex:1; min-width:240px }
  button { background:#243444; color:var(--ink); border:1px solid #325069; padding:6px 14px; border-radius:6px; cursor:pointer; font-weight:600; letter-spacing:.5px }
  button:hover { background:#2e4860 }
  .grid { display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); }
  .card { background:var(--panel); border:1px solid #25313d; border-radius:14px; padding:14px 16px; display:flex; flex-direction:column; gap:10px; position:relative; box-shadow:0 4px 10px -4px rgba(0,0,0,.5) }
  .card h2 { margin:0; font-size:1.05rem; display:flex; align-items:center; gap:8px; font-weight:600 }
  .cat { font-size:.65rem; padding:2px 6px; border-radius:4px; background:#243444; letter-spacing:.5px; text-transform:uppercase; color:#b2cee9 }
  .dlc { font-size:.55rem; padding:2px 6px; border-radius:4px; background:#3a2d44; color:#d6b2ff; letter-spacing:.5px }
  table { border-collapse:collapse; width:100%; font-size:.72rem }
  th, td { text-align:left; padding:4px 6px; border-bottom:1px solid #22313f }
  th { font-weight:600; font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; color:#9cb4c9 }
  tbody tr:last-child td { border-bottom:none }
  .pill { display:inline-block; padding:2px 6px; background:#233240; border:1px solid #2f4252; border-radius:16px; font-size:.6rem; margin:0 4px 4px 0 }
  .classes { display:flex; flex-wrap:wrap; gap:2px }
  .metric { font-weight:600 }
  .bad { color:var(--bad) } .good { color:var(--good) } .warn { color:var(--warn) }
  .notes { font-size:.65rem; color:var(--muted); line-height:1.3 }
  footer { margin:40px 0 60px; text-align:center; font-size:.65rem; color:#5c748a }
  .empty { padding:40px; text-align:center; opacity:.7 }
  nav { display:flex; gap:12px; font-size:.7rem; align-items:center }
  nav a.active { background:#203041; padding:6px 10px; border-radius:6px; font-weight:600 }
</style>
</head>
<body>
<header>
  <div>
    <h1>Weapons & Ammo Reference</h1>
    <div class="sub">Filterable list of firearms and compatible ammunition (early draft).</div>
  </div>
  <nav>
    <a href="index.html">Species</a>
    <a href="weapons.html" class="active">Weapons</a>
  </nav>
</header>
<main>
  <div class="controls">
    <input id="search" type="search" placeholder="Search weapon or ammo..." />
    <select id="categoryFilter"><option value="">All Categories</option></select>
    <select id="classFilter"><option value="">Any Class Coverage</option></select>
    <select id="dlcFilter"><option value="">All DLC</option></select>
    <button id="resetBtn">Reset</button>
  </div>
  <div id="cards" class="grid" aria-live="polite"></div>
  <div id="empty" class="empty" style="display:none">No weapons match your filters.</div>
</main>
<footer>
  Data is illustrative / placeholder; tune numbers to match in‑game values you prefer. — Local storage remembers last filters.
</footer>
<script>
const LS_KEY = 'hunter.weapons.v1';
let WEAPONS = [];

async function loadWeapons(){
  try {
    const res = await fetch('weapons.json', { cache:'no-store'});
    const txt = await res.text();
    let data;
    try { data = JSON.parse(txt); }
    catch { data = txt.split(/\r?\n/).filter(Boolean).map(l=>{ try{return JSON.parse(l)}catch{return null}}).filter(Boolean); }
    if(!Array.isArray(data)) throw new Error('Unexpected weapons.json format');
    WEAPONS = data;
    buildFilters();
    applyFilters();
  } catch(err){
    document.getElementById('cards').innerHTML = `<div style="padding:16px;color:#ff8686">Failed to load weapons.json: ${err.message}</div>`;
  }
}

function buildFilters(){
  const catSel = document.getElementById('categoryFilter');
  const classSel = document.getElementById('classFilter');
  const dlcSel = document.getElementById('dlcFilter');
  const cats = [...new Set(WEAPONS.map(w=>w.category))].sort();
  const dlcs = [...new Set(WEAPONS.map(w=>w.dlc))].sort();
  const allClasses = new Set();
  WEAPONS.forEach(w=> (w.ammo||[]).forEach(a=> (a.classes||[]).forEach(c=> allClasses.add(c))));
  cats.forEach(c=> catSel.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
  dlcs.forEach(d=> dlcSel.insertAdjacentHTML('beforeend', `<option value="${d}">${d}</option>`));
  [...allClasses].sort((a,b)=>a-b).forEach(c=> classSel.insertAdjacentHTML('beforeend', `<option value="${c}">Needs Class ${c}</option>`));
  restoreState();
}

function ammoTableRows(ammoList){
  return ammoList.map(a=>{
    const classes = (a.classes||[]).map(c=>`<span class="pill">${c}</span>`).join('');
    return `<tr>
      <td>${a.name}</td>
      <td><div class="classes">${classes}</div></td>
      <td class="metric">${a.penetration ?? '—'}</td>
      <td class="metric">${a.expansion ?? '—'}</td>
      <td>${a.notes? `<span class="notes">${a.notes}</span>`:''}</td>
    </tr>`;
  }).join('');
}

function weaponCard(w){
  return `<div class="card" data-weapon="${w.weapon}">
    <h2>${w.weapon} <span class="cat">${w.category}</span> <span class="dlc">${w.dlc}</span></h2>
    <div class="notes">${w.notes||''}</div>
    <table aria-label="Ammo for ${w.weapon}">
      <thead><tr><th>Ammo</th><th>Classes</th><th>Pen</th><th>Exp</th><th>Notes</th></tr></thead>
      <tbody>${ammoTableRows(w.ammo||[])}</tbody>
    </table>
  </div>`;
}

function applyFilters(){
  const q = document.getElementById('search').value.toLowerCase().trim();
  const cat = document.getElementById('categoryFilter').value;
  const cl = document.getElementById('classFilter').value;
  const dlc = document.getElementById('dlcFilter').value;
  let list = WEAPONS.slice();
  if(cat) list = list.filter(w=> w.category===cat);
  if(dlc) list = list.filter(w=> w.dlc===dlc);
  if(cl) list = list.filter(w=> (w.ammo||[]).some(a=> (a.classes||[]).includes(Number(cl))));
  if(q) list = list.filter(w=>{
    const hay = [w.weapon, w.category, w.dlc, w.notes, ...(w.ammo||[]).map(a=> a.name)].join(' ').toLowerCase();
    return hay.includes(q);
  });
  const grid = document.getElementById('cards');
  const empty = document.getElementById('empty');
  if(!list.length){ grid.innerHTML=''; empty.style.display='block'; }
  else { empty.style.display='none'; grid.innerHTML = list.map(weaponCard).join(''); }
  saveState();
}

function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify({
    q: document.getElementById('search').value,
    cat: document.getElementById('categoryFilter').value,
    cls: document.getElementById('classFilter').value,
    dlc: document.getElementById('dlcFilter').value
  }));
}
function restoreState(){
  try { var st = JSON.parse(localStorage.getItem(LS_KEY)||'{}'); } catch { st = {}; }
  if(st.q) document.getElementById('search').value = st.q;
  if(st.cat) document.getElementById('categoryFilter').value = st.cat;
  if(st.cls) document.getElementById('classFilter').value = st.cls;
  if(st.dlc) document.getElementById('dlcFilter').value = st.dlc;
}

document.getElementById('search').addEventListener('input', applyFilters);
['categoryFilter','classFilter','dlcFilter'].forEach(id=> document.getElementById(id).addEventListener('change', applyFilters));

document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.getElementById('search').value='';
  ['categoryFilter','classFilter','dlcFilter'].forEach(id=> document.getElementById(id).value='');
  applyFilters();
});

loadWeapons();
</script>
</body>
</html>
