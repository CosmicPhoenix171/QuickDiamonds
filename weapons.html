<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hunter Weapons & Ammo Reference</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root {
    --bg:#0f141b; --panel:#18222d; --ink:#e6f1ff; --accent:#3aa8ff; --grid: #22313f;
    --good:#3bcf6e; --warn:#ffb347; --bad:#ff5964; --muted:#7f94ab;
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  body { margin:0; background:linear-gradient(180deg,#0e1319,#161f28); color:var(--ink); min-height:100vh; }
  header { padding:16px 24px; background:#121a22; border-bottom:1px solid #1f2b35; display:flex; align-items:center; justify-content:space-between; gap:24px; flex-wrap:wrap }
  h1 { margin:0; font-size:clamp(1.2rem,2vw,1.8rem); letter-spacing:.5px }
  .sub { font-size:.8rem; color:var(--muted); margin-top:4px }
  a { color:var(--accent); text-decoration:none }
  a:hover { text-decoration:underline }
  main { padding:20px clamp(12px,3vw,48px); max-width:1400px; margin:0 auto }
  .controls { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px }
  .controls select, .controls input { background:#1d2732; color:var(--ink); border:1px solid #273543; padding:6px 10px; border-radius:6px; font-size:.85rem; min-width:140px }
  .controls input[type=search]{ flex:1; min-width:240px }
  button { background:#243444; color:var(--ink); border:1px solid #325069; padding:6px 14px; border-radius:6px; cursor:pointer; font-weight:600; letter-spacing:.5px }
  button:hover { background:#2e4860 }
  /* List layout replacing card grid */
  .list { display:flex; flex-direction:column; gap:6px; }
  .weapon-row { background:var(--panel); border:1px solid #25313d; border-radius:10px; padding:8px 12px; display:grid; gap:12px; grid-template-columns: clamp(180px,18%,240px) clamp(300px,32%,420px) 1fr; align-items:flex-start; position:relative; }
  .weapon-row h2 { margin:0 0 4px 0; font-size:.85rem; display:flex; flex-wrap:wrap; align-items:center; gap:6px; font-weight:600 }
  .w-meta { display:flex; flex-direction:column; gap:2px; min-width:0 }
  .stats-inline { display:flex; flex-wrap:wrap; gap:4px; }
  .stats-inline .stat { min-width:54px; flex:0 0 auto; }
  .ammo-inline { display:flex; flex-wrap:wrap; gap:6px; align-items:flex-start; }
  .ammo-pill2 { background:#1d2732; border:1px solid #273543; padding:4px 6px; border-radius:16px; font-size:.55rem; font-weight:600; display:inline-flex; gap:4px; align-items:center; line-height:1.1 }
  .ammo-pill2 .ae { font-weight:500; opacity:.75 }
  .ammo-pill2:hover { background:#223241; border-color:#335066 }
  .ammo-more { font-size:.55rem; opacity:.6; padding:4px 6px }
  @media (max-width:1100px){
    .weapon-row { grid-template-columns: clamp(180px,30%,240px) 1fr; }
    .weapon-row .ammo-inline { grid-column: 1 / -1; }
  }
  @media (max-width:720px){
    .weapon-row { grid-template-columns: 1fr; }
    .stats-inline { order:2 }
    .ammo-inline { order:3 }
  }
  .weapon-row + .weapon-row { margin-top:2px }
  .cat { font-size:.65rem; padding:2px 6px; border-radius:4px; background:#243444; letter-spacing:.5px; text-transform:uppercase; color:#b2cee9 }
  .dlc { font-size:.55rem; padding:2px 6px; border-radius:4px; background:#3a2d44; color:#d6b2ff; letter-spacing:.5px }
  .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(58px,1fr)); gap:6px; margin-top:2px }
  .stat { background:#1d2732; border:1px solid #273543; padding:4px 6px 5px; border-radius:8px; display:flex; flex-direction:column; gap:2px; min-height:38px }
  .stat-l { font-size:.5rem; letter-spacing:.7px; font-weight:600; text-transform:uppercase; color:#7f94ab }
  .stat-v { font-size:.7rem; font-weight:600; }
  /* Ammo redesigned grid */
  .ammo-block { margin-top:4px; display:flex; flex-direction:column; gap:6px }
  .ammo-head, .ammo-row { width:100%; box-sizing:border-box }
  /* Compact widths so all columns fit inside 320px card */
  .ammo-head { display:grid; grid-template-columns:minmax(60px,1fr) 50px 38px 38px 42px 42px; gap:4px;
    padding:4px 6px; font-size:.55rem; text-transform:uppercase; letter-spacing:.5px;
    background:#1b2631; border:1px solid #273543; border-radius:8px; color:#9cb4c9; font-weight:600 }
  .ammo-row { display:grid; grid-template-columns:minmax(60px,1fr) 50px 38px 38px 42px 42px; gap:4px;
    align-items:center; padding:4px 6px; background:#18222d; border:1px solid #22313f;
    border-radius:8px; font-size:.6rem; position:relative }
  .ammo-head.notes { grid-template-columns:minmax(60px,1fr) 50px minmax(55px,1fr) 38px 38px 42px 42px; }
  .ammo-row.notes { grid-template-columns:minmax(60px,1fr) 50px minmax(55px,1fr) 38px 38px 42px 42px; }
  .ammo-row:not(:last-child){ margin-bottom:3px }
  .ammo-row:hover { border-color:#2f4658; background:#1d2b36 }
  .ammo-name { font-weight:600; line-height:1.2 }
  .ammo-classes { display:flex; flex-wrap:wrap; gap:4px }
  .ammo-pill { background:#233240; border:1px solid #2d4253; padding:2px 6px; border-radius:14px; font-size:.55rem; font-weight:600 }
  .metric-box { display:flex; flex-direction:column; gap:2px }
  .bar-wrap { height:6px; background:#111b23; border:1px solid #253644; border-radius:4px; overflow:hidden }
  .bar { height:100%; background:linear-gradient(90deg,var(--accent),#6ad4ff); width:0%; transition:width .35s }
  .bar.exp { background:linear-gradient(90deg,#ff8a3a,#ffd089) }
  .metric-val { font-weight:600; text-align:center; font-size:.65rem }
  .ammo-dash { opacity:.4 }
  .align-r { text-align:right; font-variant-numeric:tabular-nums }
  .notes-cell { font-size:.55rem; color:#7f94ab; line-height:1.25 }
  @media (max-width:720px){
    .ammo-head { grid-template-columns:minmax(55px,1fr) 46px 34px 34px 38px 38px; font-size:.5rem }
    .ammo-row { grid-template-columns:minmax(55px,1fr) 46px 34px 34px 38px 38px; font-size:.55rem }
    .ammo-head.notes { grid-template-columns:minmax(55px,1fr) 44px minmax(50px,1fr) 34px 34px 38px 38px; }
    .ammo-row.notes { grid-template-columns:minmax(55px,1fr) 44px minmax(50px,1fr) 34px 34px 38px 38px; }
  }
  /* End ammo redesign */
  .bad { color:var(--bad) } .good { color:var(--good) } .warn { color:var(--warn) }
  .notes { font-size:.65rem; color:var(--muted); line-height:1.3 }
  footer { margin:40px 0 60px; text-align:center; font-size:.65rem; color:#5c748a }
  .empty { padding:40px; text-align:center; opacity:.7 }
  nav { display:flex; gap:12px; font-size:.7rem; align-items:center }
  nav a.active { background:#203041; padding:6px 10px; border-radius:6px; font-weight:600 }
</style>
</head>
<body>
<header>
  <div>
    <h1>Weapons & Ammo Reference</h1>
    <div class="sub">Filterable list of firearms and compatible ammunition (early draft).</div>
  </div>
  <nav>
    <a href="index.html">Species</a>
    <a href="weapons.html" class="active">Weapons</a>
  </nav>
</header>
<main>
  <div class="controls">
  <input id="search" type="search" placeholder="Search weapon or ammo..." />
  <select id="animalFilter" multiple size="4"><option value="">Any Animal</option></select>
  <select id="categoryFilter"><option value="">All Categories</option></select>
  <select id="classFilter"><option value="">Any Class Coverage</option></select>
  <select id="sortSelect"><option value="">Default Order</option><option value="pen-desc">Pen High→Low</option><option value="pen-asc">Pen Low→High</option><option value="exp-desc">Exp High→Low</option><option value="exp-asc">Exp Low→High</option></select>
  <button id="resetBtn">Reset</button>
  </div>
  <div id="cards" class="list" aria-live="polite"></div>
  <div id="empty" class="empty" style="display:none">No weapons match your filters.</div>
</main>
<footer>
  Data is illustrative / placeholder; tune numbers to match in‑game values you prefer. — Local storage remembers last filters.
</footer>
<script>
const LS_KEY = 'hunter.weapons.v1';
let WEAPONS = [];

async function loadWeapons(){
  try {
    const res = await fetch('weapons.json', { cache:'no-store'});
    const txt = await res.text();
    let data;
    try { data = JSON.parse(txt); }
    catch { data = txt.split(/\r?\n/).filter(Boolean).map(l=>{ try{return JSON.parse(l)}catch{return null}}).filter(Boolean); }
    if(!Array.isArray(data)) throw new Error('Unexpected weapons.json format');
    WEAPONS = data;
  buildFilters();
  buildAnimalFilter();
  applyFilters();
  } catch(err){
    document.getElementById('cards').innerHTML = `<div style="padding:16px;color:#ff8686">Failed to load weapons.json: ${err.message}</div>`;
  }
}

function buildFilters(){
  const catSel = document.getElementById('categoryFilter');
  const classSel = document.getElementById('classFilter');
  const cats = [...new Set(WEAPONS.map(w=>w.category))].sort();
  const allClasses = new Set();
  WEAPONS.forEach(w=> (w.ammo||[]).forEach(a=> (a.classes||[]).forEach(c=> allClasses.add(c))));
  cats.forEach(c=> catSel.insertAdjacentHTML('beforeend', `<option value="${c}">${c}</option>`));
  [...allClasses].sort((a,b)=>a-b).forEach(c=> classSel.insertAdjacentHTML('beforeend', `<option value="${c}">Needs Class ${c}</option>`));
  restoreState();
}

function buildAnimalFilter(){
  const animalSel = document.getElementById('animalFilter');
  animalSel.innerHTML = '<option value="">Any Animal</option>';
  // Collect all animals from usableOn arrays in weapons/ammo
  const animals = new Set();
  WEAPONS.forEach(w => {
    (w.ammo||[]).forEach(a => {
      (a.usableOn||[]).forEach(an => animals.add(an));
    });
  });
  [...animals].sort().forEach(an => animalSel.insertAdjacentHTML('beforeend', `<option value="${an}">${an}</option>`));
}

function ammoRow(a){
  const classes = (a.classes||[]).map(c=>`<span class="ammo-pill" title="Class ${c}">${c}</span>`).join('') || '<span class="ammo-dash">—</span>';
  const pen = a.penetration ?? null;
  const exp = a.expansion ?? null;
  const penPct = Math.min(100, (pen||0));
  const expPct = Math.min(100, (exp||0));
  const range = a.range ?? a.maxRange ?? null;
  const price = (a.price !== undefined && a.price !== null) ? a.price : null;
  return `<div class="ammo-row">
    <div class="ammo-name">${a.name}</div>
    <div class="ammo-classes">${classes}</div>
    <div class="notes-cell">${a.notes||''}</div>
    <div class="metric-box" title="Penetration ${pen ?? 'n/a'}"><div class="metric-val">${pen ?? '—'}</div><div class="bar-wrap"><div class="bar" style="width:${penPct}%;"></div></div></div>
    <div class="metric-box" title="Expansion ${exp ?? 'n/a'}"><div class="metric-val">${exp ?? '—'}</div><div class="bar-wrap"><div class="bar exp" style="width:${expPct}%;"></div></div></div>
    <div class="align-r">${range ?? '—'}</div>
    <div class="align-r">${price ?? '—'}</div>
  </div>`;
}

function ammoBlock(ammoList){
  if(!ammoList || !ammoList.length) return '<div class="notes" style="opacity:.6">No ammo data.</div>';
  const hasNotes = ammoList.some(a=>a.notes);
  if(!hasNotes){
    // Compact variant without notes column
    return `<div class="ammo-block">
      <div class="ammo-head">
        <div>Ammo</div>
        <div>Classes</div>
        <div>Pen</div>
        <div>Exp</div>
        <div>Range</div>
        <div>Price</div>
      </div>
      ${ammoList.map(a=>{
        const classes = (a.classes||[]).map(c=>`<span class=\"ammo-pill\" title=\"Class ${c}\">${c}</span>`).join('') || '<span class=\"ammo-dash\">—</span>';
        const pen=a.penetration??null, exp=a.expansion??null, penPct=Math.min(100,(pen||0)), expPct=Math.min(100,(exp||0));
        const range=a.range??a.maxRange??null; const price=(a.price!==undefined&&a.price!==null)?a.price:null;
        return `<div class=\"ammo-row\">\n          <div class=\"ammo-name\">${a.name}</div>\n          <div class=\"ammo-classes\">${classes}</div>\n          <div class=\"metric-box\" title=\"Penetration ${pen??'n/a'}\"><div class=\"metric-val\">${pen??'—'}<\/div><div class=\"bar-wrap\"><div class=\"bar\" style=\"width:${penPct}%;\"><\/div><\/div><\/div>\n          <div class=\"metric-box\" title=\"Expansion ${exp??'n/a'}\"><div class=\"metric-val\">${exp??'—'}<\/div><div class=\"bar-wrap\"><div class=\"bar exp\" style=\"width:${expPct}%;\"><\/div><\/div><\/div>\n          <div class=\"align-r\">${range??'—'}<\/div>\n          <div class=\"align-r\">${price??'—'}<\/div>\n        <\/div>`;
      }).join('')}
    </div>`;
  }
  return `<div class="ammo-block">
    <div class="ammo-head notes">
      <div>Ammo</div>
      <div>Classes</div>
      <div>Notes</div>
      <div>Pen</div>
      <div>Exp</div>
      <div>Range</div>
      <div>Price</div>
    </div>
    ${ammoList.map(ammoRow).map(r=>r.replace('ammo-row"','ammo-row notes"')).join('')}
  </div>`;
}

function weaponRow(w){
  const stats = [
    ['Value', w.value],
    ['Weight', w.weight],
    ['Score', w.score],
    ['Acc', w.accuracy],
    ['Recoil', w.recoil],
    ['Reload', w.reload],
    ['Hip', w.hipshot],
    ['Mag', w.magazine]
  ];
  const statsHtml = `<div class="stats-inline">${stats.map(([l,v])=>`<div class=\"stat\"><span class=\"stat-l\">${l}</span><span class=\"stat-v\">${v ?? '—'}</span></div>`).join('')}</div>`;
  const ammoList = (w.ammo||[]);
  let ammoHtml;
  if(!ammoList.length){
    ammoHtml = '<div class="ammo-inline" style="opacity:.6;font-size:.55rem">No ammo data</div>';
  } else {
    const maxShow = 10; // truncate very long lists
    const pills = ammoList.slice(0,maxShow).map(a=>{
      const pen=a.penetration??'—';
      const exp=a.expansion??'—';
      const range=a.range??a.maxRange??'—';
      const price=(a.price!==undefined&&a.price!==null)?a.price:'—';
      const classes=(a.classes||[]).join(',')||'–';
      return `<span class=\"ammo-pill2\" title=\"Classes: ${classes}\nPen: ${pen}\nExp: ${exp}\nRange: ${range}\nPrice: ${price}\">${a.name}<span class=\"ae\">(${pen}/${exp})</span></span>`;
    }).join('');
    const more = ammoList.length>maxShow ? `<span class=\"ammo-more\">+${ammoList.length-maxShow} more</span>`:'';
    ammoHtml = `<div class=\"ammo-inline\">${pills}${more}</div>`;
  }
  return `<div class="weapon-row" data-weapon="${w.weapon}">
    <div class="w-meta">
      <h2>${w.weapon} <span class="cat">${w.category}</span> <span class="dlc">${w.dlc}</span></h2>
    </div>
    ${statsHtml}
    ${ammoHtml}
  </div>`;
}

function applyFilters(){
  const q = document.getElementById('search').value.toLowerCase().trim();
  const animalSel = document.getElementById('animalFilter');
  const selectedAnimals = Array.from(animalSel.selectedOptions).map(opt => opt.value).filter(v => v);
  const cat = document.getElementById('categoryFilter').value;
  const cl = document.getElementById('classFilter').value;
  const sort = document.getElementById('sortSelect').value;
  let list = WEAPONS.slice();
  if(cat) list = list.filter(w=> w.category===cat);
  if(cl) list = list.filter(w=> (w.ammo||[]).some(a=> (a.classes||[]).includes(Number(cl))));
  if(selectedAnimals.length) {
    list = list.filter(w => (w.ammo||[]).some(a => (a.usableOn||[]).some(an => selectedAnimals.includes(an))));
  }
  if(q) list = list.filter(w=>{
    const hay = [w.weapon, w.category, w.dlc, w.notes, ...(w.ammo||[]).map(a=> a.name)].join(' ').toLowerCase();
    return hay.includes(q);
  });
  if(sort){
    const metric = (w, kind) => {
      const vals = (w.ammo||[]).map(a=> kind==='pen'? (a.penetration??0) : (a.expansion??0));
      return vals.length? Math.max(...vals) : -Infinity;
    };
    if(sort==='pen-desc') list.sort((a,b)=> metric(b,'pen') - metric(a,'pen'));
    else if(sort==='pen-asc') list.sort((a,b)=> metric(a,'pen') - metric(b,'pen'));
    else if(sort==='exp-desc') list.sort((a,b)=> metric(b,'exp') - metric(a,'exp'));
    else if(sort==='exp-asc') list.sort((a,b)=> metric(a,'exp') - metric(b,'exp'));
  }
  const grid = document.getElementById('cards');
  const empty = document.getElementById('empty');
  if(!list.length){ grid.innerHTML=''; empty.style.display='block'; }
  else { empty.style.display='none'; grid.innerHTML = list.map(weaponRow).join(''); }
  saveState();
}

function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify({
    q: document.getElementById('search').value,
    animals: Array.from(document.getElementById('animalFilter').selectedOptions).map(opt => opt.value),
    cat: document.getElementById('categoryFilter').value,
    cls: document.getElementById('classFilter').value,
    sort: document.getElementById('sortSelect').value
  }));
}
function restoreState(){
  try { var st = JSON.parse(localStorage.getItem(LS_KEY)||'{}'); } catch { st = {}; }
  if(st.q) document.getElementById('search').value = st.q;
  if(st.animals && Array.isArray(st.animals)) {
    const animalSel = document.getElementById('animalFilter');
    Array.from(animalSel.options).forEach(opt => {
      opt.selected = st.animals.includes(opt.value);
    });
  }
  if(st.cat) document.getElementById('categoryFilter').value = st.cat;
  if(st.cls) document.getElementById('classFilter').value = st.cls;
  if(st.sort) document.getElementById('sortSelect').value = st.sort;
}

document.getElementById('search').addEventListener('input', applyFilters);
['animalFilter','categoryFilter','classFilter','sortSelect'].forEach(id=> document.getElementById(id).addEventListener('change', applyFilters));

document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.getElementById('search').value='';
  ['categoryFilter','classFilter','sortSelect'].forEach(id=> document.getElementById(id).value='');
  applyFilters();
});

loadWeapons();
</script>
</body>
</html>
