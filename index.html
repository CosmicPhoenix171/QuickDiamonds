<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hunter Diamonds â€” Quick Reference</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --muted:#7f8a9a; --text:#e7edf5; --accent:#5cc8ff; --accent-2:#9bffd6;
      --chip:#1b2430; --chip-border:#2a3442; --border:#121a26;
    }
    html,body{height:100%}
    body{margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text); background:linear-gradient(180deg,#0a0f15,#0b1017 30%,#0e141d)}

    header{position:sticky; top:0; backdrop-filter:saturate(1.2) blur(6px); background:rgba(11,16,23,.85); border-bottom:1px solid #0f1722; z-index:10}
    .wrap{max-width:1200px; margin:0 auto; padding:16px}
    h1{font-size:clamp(20px,2.2vw,28px); margin:0 0 6px}
    .sub{color:var(--muted); font-size:13px}

    /* Single-column layout (sidebar removed) */
    .layout{max-width:1200px; margin:16px auto; display:grid; grid-template-columns: 1fr; gap:14px; padding:0 16px}
    #sidebar{display:none}
    main{min-height:60vh}

    .controls{display:grid; grid-template-columns: 220px 1fr 170px 170px; gap:10px; margin-bottom:12px}
    .controls input, .controls select{background:#0e1520; color:var(--text); border:1px solid #1d2734; border-radius:10px; padding:10px 12px; outline:none; font-size:14px}
    .controls input::placeholder{color:#708095}

    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden; box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .card-head{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:14px 16px; background:#0f1621; border-bottom:1px solid #1a2330}
    .card-title{font-weight:700}
    .card-sub{color:#8ea3bb; font-size:12px}

    table{width:100%; border-collapse:collapse; table-layout:auto}
    thead th{position:sticky; top:0; background:#0f1621; color:#b9c7da; font-weight:600; font-size:12px; text-transform:uppercase; letter-spacing:.08em; padding:12px 10px; border:1px solid #1a2330; cursor:pointer; user-select:none; white-space:nowrap}
    tbody td{padding:10px 10px; border:1px solid #1a2330; font-size:14px; line-height:1.4; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:middle}
    tbody tr:nth-child(even){background:#0e141d}
    tbody tr:hover{background:#121a1f}
    td.num, th.num{text-align:right}
    td.center, th.center{text-align:center}
    td.left{text-align:left}
    td.nowrap{text-align:left}

    .chips{display:flex; flex-wrap:wrap; gap:6px; justify-content:flex-start}
    .chip{background:var(--chip); border:1px solid var(--chip-border); padding:4px 8px; border-radius:999px; font-size:12px; color:#c6d3e6; white-space:nowrap}
    .class{font-weight:700; color:var(--accent)}
    .sex{white-space:nowrap; min-width:70px; text-align:center}
    .hint{color:#8ea3bb; font-size:12px; margin-top:8px}
    .empty{color:#90a4bf; font-size:14px; padding:12px}

    footer{color:#7c8da3; font-size:12px; padding:14px 0}

    .chip.r-bronze{border-color:#cd7f32; background:#2a1d14; color:#cd7f32; font-weight:600; box-shadow:0 0 6px rgba(205,127,50,0.6)}
    .chip.r-silver{border-color:silver; background:#1a1a1a; color:#c0c0c0; font-weight:600; box-shadow:0 0 6px rgba(192,192,192,0.6)}
    .chip.r-rare{border-color:gold; background:#1a1a00; color:gold; font-weight:600; box-shadow:0 0 6px rgba(255,215,0,0.6)}
    .chip.r-ultra{border-color:#6b1e1e; background:#241010; color:#ff4d4d; font-weight:600; box-shadow:0 0 6px rgba(255,0,0,0.6)}

    .diamond-val{display:inline-block; padding:4px 8px; border-radius:6px; background:#0a2233; border:1px solid #2e9dd8; color:#5cc8ff; font-weight:700; box-shadow:0 0 6px rgba(92,200,255,0.6)}

    .legend{margin-top:8px; display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .legend strong{margin-right:6px}

    /* Column sizing */
    thead th:nth-child(1), tbody td:nth-child(1){width:60px; text-align:center}
    thead th:nth-child(2), tbody td:nth-child(2){min-width:200px; text-align:left}
    thead th:nth-child(3), tbody td:nth-child(3){width:130px; text-align:center}
    thead th:nth-child(4), tbody td:nth-child(4){width:130px; text-align:right}
    thead th:nth-child(5), tbody td:nth-child(5){min-width:170px; text-align:left}
    thead th:nth-child(6), tbody td:nth-child(6){width:90px; text-align:center}
    thead th:nth-child(7), tbody td:nth-child(7){min-width:260px;}

    @media (max-width: 980px){
      .controls{grid-template-columns: 1fr 1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between;">
      <div>
        <h1>Hunter Diamonds â€” Quick Reference</h1>
        <div class="sub">Pick a map with the dropdown. Selected mapâ€™s table appears below. Fully offline.</div>
      </div>
      <a href="guns.html"
         style="background:#5cc8ff; color:#0b0f14; padding:8px 16px; border-radius:8px; font-weight:600; text-decoration:none; box-shadow:0 2px 6px rgba(0,0,0,.4);">
        ðŸ”« Guns & Ammo
      </a>
    </div>
  </header>

  <div class="layout">
    <!-- (Sidebar removed; we build from dropdown) -->

    <main>
      <div class="controls">
        <select id="mapSelect"><option value="">Select mapâ€¦</option></select>
        <input id="search" type="search" placeholder="Search animals, variants, notesâ€¦"/>
        <select id="classFilter"><option value="">All Classes</option></select>
        <select id="sexFilter">
          <option value="">All Sexes</option>
          <option value="M">Male-only</option>
          <option value="F">Female-only</option>
          <option value="MF">Both</option>
        </select>
      </div>

      <div class="card" id="panel">
        <div class="card-head">
          <div>
            <div class="card-title" id="panel-title">Select a map</div>
            <div class="card-sub" id="panel-sub">â€”</div>
          </div>
          <div class="hint">Click a column header to sort. Last selection & filters are remembered.</div>
        </div>
        <div id="panel-body"><div class="empty">Choose a map from the dropdown to load its species table.</div></div>
      </div>

      <footer>
        <div class="legend">
          <strong>Legend:</strong>
          <span class="chip r-bronze">â‰¥25% Bronze</span>
          <span class="chip r-silver">6â€“24% Silver</span>
          <span class="chip r-rare">â‰¤5% Gold</span>
          <span class="chip r-ultra">â‰¤0.1% Ultra Rare</span>
        </div>
      </footer>
    </main>
  </div>

  <script>
/* =========================
   MAP CATALOG (names/ids)
   ========================= */
const MAPS_BASE = [
  { id:"layton", name:"Layton Lake District", region:"Pacific Northwest, USA" },
  { id:"hirsch", name:"Hirschfelden Hunting Reserve", region:"Germany" }
];
const MAPS_DLC = [
  { id:"medved", name:"Medved-Taiga National Park", region:"Siberia, Russia" },
  { id:"vurhonga", name:"Vurhonga Savanna Reserve", region:"Africa" },
  { id:"parque", name:"Parque Fernando", region:"Argentina" },
  { id:"yukon", name:"Yukon Valley", region:"Alaska" },
  { id:"cuatro", name:"Cuatro Colinas Game Reserve", region:"Spain" },
  { id:"silverridge", name:"Silver Ridge Peaks", region:"Colorado" },
  { id:"teawaroa", name:"Te Awaroa National Park", region:"New Zealand" },
  { id:"rancho", name:"Rancho del Arroyo", region:"Mexico" },
  { id:"mississippi", name:"Mississippi Acres Preserve", region:"USA" },
  { id:"revontuli", name:"Revontuli Coast", region:"Finland" },
  { id:"newengland", name:"New England Mountains", region:"USA" },
  { id:"emerald", name:"Emerald Coast", region:"Australia" }
];
const MAPS_BY_ID = [...MAPS_BASE, ...MAPS_DLC].reduce((a,m)=> (a[m.id]=m, a), {});

/* ============================================================
   PASTE YOUR EXISTING SPECIES ARRAY HERE (unchanged structure)
   The page will still run with these sample rows.
   ============================================================ */
const SPECIES = [
  // SAMPLE ROWS â€” replace with your full array
  { class:1, animal:"Mallard Duck", maxDifficulty:"3 (Very Easy)", diamond:19.63, basis:"Weight-based (Body)", minWeight:"1.6 kg / 3.5 lbs", sex:"M / F", variants:["Brown 80%","Dark 10%","Grey 5%","Melanistic 1%","Albino 0.1%","Piebald 0.1%"], maps:["layton","revontuli","newengland"] },
  { class:4, animal:"Whitetail Deer", maxDifficulty:"5 (Medium)", diamond:255.09, basis:"Organ-based (Antlers)", minWeight:"â€“", sex:"M", variants:["Brown 90%","Tan 5%","Grey 3%","Dark Brown 1%","Piebald 0.4%","Melanistic 0.2%","Albino 0.1%"], maps:["layton","rancho","mississippi","revontuli","newengland"] },
  { class:8, animal:"Moose", maxDifficulty:"9 (Legendary)", diamond:274.99, basis:"Organ-based (Antlers)", minWeight:"â€“", sex:"M", variants:["Brown 85%","Light Brown 10%","Dark Brown 3%","Grey 1%","Melanistic 0.2%","Albino 0.1%"], maps:["layton","medved","yukon","revontuli","newengland"] },
];

/* =========================
   STATE
   ========================= */
let currentMap = "";
let currentSort = { key: "animal", dir: 1 }; // 1 asc, -1 desc

/* =========================
   INIT UI
   ========================= */
const mapSelect = document.getElementById('mapSelect');
const classFilter = document.getElementById('classFilter');
const sexFilter = document.getElementById('sexFilter');
const searchInput = document.getElementById('search');
const panelTitle = document.getElementById('panel-title');
const panelSub = document.getElementById('panel-sub');
const panelBody = document.getElementById('panel-body');

// populate map dropdown (only maps that exist in SPECIES)
const mapIdsUsed = new Set(SPECIES.flatMap(s => s.maps || []));
[...MAPS_BASE, ...MAPS_DLC]
  .filter(m => mapIdsUsed.has(m.id))
  .forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = m.name;
    mapSelect.appendChild(opt);
  });

// restore last selections
(function restoreState(){
  try {
    const savedMap = localStorage.getItem('lastMap');
    const savedClass = localStorage.getItem('lastClassFilter') || "";
    const savedSex = localStorage.getItem('lastSexFilter') || "";
    const savedSearch = localStorage.getItem('lastSearch') || "";
    if (savedMap && mapIdsUsed.has(savedMap)) {
      mapSelect.value = savedMap;
      currentMap = savedMap;
    }
    classFilter.value = savedClass;
    sexFilter.value = savedSex;
    searchInput.value = savedSearch;
  } catch {}
})();

/* =========================
   EVENTS
   ========================= */
mapSelect.addEventListener('change', () => {
  currentMap = mapSelect.value;
  try { localStorage.setItem('lastMap', currentMap); } catch {}
  buildClassOptions();
  render();
});

classFilter.addEventListener('change', () => {
  try { localStorage.setItem('lastClassFilter', classFilter.value); } catch {}
  render();
});
sexFilter.addEventListener('change', () => {
  try { localStorage.setItem('lastSexFilter', sexFilter.value); } catch {}
  render();
});
searchInput.addEventListener('input', () => {
  try { localStorage.setItem('lastSearch', searchInput.value); } catch {}
  render();
});

/* =========================
   RENDERING
   ========================= */
function buildClassOptions(){
  // build classes for the selected map
  const classes = new Set(
    SPECIES.filter(s => !currentMap || (s.maps||[]).includes(currentMap))
           .map(s => s.class)
  );
  classFilter.innerHTML = '<option value="">All Classes</option>' +
    [...classes].sort((a,b)=>a-b).map(c => `<option value="${c}">Class ${c}</option>`).join('');
}

function formatVariants(list){
  if (!list || !list.length) return '';
  return '<div class="chips">' + list.map(v => {
    // style by rough rarity keywords if present
    const low = v.toLowerCase();
    let extra = '';
    if (low.includes('0.1%') || low.includes('0.05%')) extra = ' r-ultra';
    else if (low.includes('0.2%') || low.includes('0.3%') || low.includes('0.4%') || low.includes('1%') || low.includes('2%') || low.includes('5%')) extra = ' r-rare';
    else if (low.includes('6%') || low.includes('7%') || low.includes('8%') || low.includes('9%') || low.includes('10%') || low.includes('12%') || low.includes('15%') || low.includes('20%') || low.includes('24%')) extra = ' r-silver';
    else if (low.includes('25%') || low.includes('30%') || low.includes('33') || low.includes('37') || low.includes('49') || low.includes('74')) extra = ' r-bronze';
    return `<span class="chip${extra}">${v}</span>`;
  }).join('') + '</div>';
}

function render(){
  const mapMeta = MAPS_BY_ID[currentMap] || null;
  panelTitle.textContent = mapMeta ? mapMeta.name : 'Select a map';
  panelSub.textContent = mapMeta ? (mapMeta.region || 'â€”') : 'â€”';

  if (!currentMap){
    panelBody.innerHTML = '<div class="empty">Choose a map from the dropdown to load its species table.</div>';
    return;
  }

  // filters
  const q = (searchInput.value||'').trim().toLowerCase();
  const wantClass = classFilter.value ? Number(classFilter.value) : null;
  const wantSex = sexFilter.value;

  let rows = SPECIES.filter(s => (s.maps||[]).includes(currentMap));

  if (wantClass) rows = rows.filter(s => s.class === wantClass);
  if (wantSex) {
    if (wantSex === 'MF') rows = rows.filter(s => (s.sex||'').includes('M') && (s.sex||'').includes('F'));
    else rows = rows.filter(s => (s.sex||'').startsWith(wantSex));
  }
  if (q){
    rows = rows.filter(s =>
      (s.animal||'').toLowerCase().includes(q) ||
      (s.maxDifficulty||'').toLowerCase().includes(q) ||
      (s.basis||'').toLowerCase().includes(q) ||
      (s.minWeight||'').toLowerCase().includes(q) ||
      (Array.isArray(s.variants) ? s.variants.join(' ').toLowerCase().includes(q) : false)
    );
  }

  // sort
  const key = currentSort.key;
  const dir = currentSort.dir;
  rows.sort((a,b)=>{
    let va = a[key], vb = b[key];
    if (key === 'class' || key === 'diamond'){
      va = Number(va); vb = Number(vb);
      return (va - vb) * dir;
    }
    return String(va||'').localeCompare(String(vb||'')) * dir;
  });

  // build table
  const th = (label, key, extra='') =>
    `<th ${extra} data-key="${key}">${label}${currentSort.key===key ? (currentSort.dir>0?' â–²':' â–¼'):''}</th>`;

  const thead = `
    <thead>
      <tr>
        ${th('Class','class','class="center"')}
        ${th('Animal','animal')}
        ${th('Max Diff.','maxDifficulty','class="center"')}
        ${th('Trophy (Diamond)','diamond','class="num"')}
        ${th('Basis','basis')}
        ${th('Sex','sex','class="center"')}
        ${th('Fur Variants','variants')}
      </tr>
    </thead>`;

  const tbody = '<tbody>' + rows.map(s => `
    <tr>
      <td class="center"><span class="class">${s.class}</span></td>
      <td class="left">${s.animal||''}</td>
      <td class="center">${s.maxDifficulty||''}</td>
      <td class="num"><span class="diamond-val">${Number(s.diamond).toFixed(2)}</span></td>
      <td class="left">${s.basis||''}${s.minWeight && s.minWeight!=='â€“' ? `, <span class="muted">${s.minWeight}</span>`:''}</td>
      <td class="center sex">${s.sex||''}</td>
      <td class="left">${formatVariants(s.variants)}</td>
    </tr>
  `).join('') + '</tbody>';

  panelBody.innerHTML = `<table>${thead}${tbody}</table>`;

  // attach sorting
  panelBody.querySelectorAll('th[data-key]').forEach(thEl=>{
    thEl.addEventListener('click', ()=>{
      const k = thEl.getAttribute('data-key');
      if (currentSort.key === k) currentSort.dir *= -1;
      else { currentSort.key = k; currentSort.dir = 1; }
      render();
    });
  });
}

// initial build
buildClassOptions();
if (currentMap){ render(); }
  </script>
</body>
</html>
